import streamlit as st
import pandas as pd
import requests
import google.generativeai as genai
import time
import json

# --- ุจุฎุด ุฌุฏุฏ: ุชูุธูุงุช ุตูุญู ู ุฏุฑุงูุช ฺฉูุฏ ---
# ุงู ุฎุท ุณุงุฏุจุงุฑ ุฑุง ุจู ุตูุฑุช ูพุดโูุฑุถ ุจุงุฒ ูฺฏู ูโุฏุงุฑุฏ
st.set_page_config(initial_sidebar_state="expanded")

# ุงุฌุงุฏ ฺฉ ฺฉุงุฏุฑ ุฏุฑ ุณุงุฏุจุงุฑ ุจุฑุง ุฏุฑุงูุช ฺฉูุฏ
api_key = st.sidebar.text_input("ฺฉูุฏ API ฺฏูฺฏู (Gemini)", type="password")

# ุจุฑุฑุณ ูโฺฉูู ฺฉู ุขุง ฺฉูุฏ ูุงุฑุฏ ุดุฏู ุงุณุช ุง ูู
if api_key:
    # ุงฺฏุฑ ฺฉูุฏ ุจูุฏุ ููุด ูุตููุน ุฑุง ูุนุงู ฺฉู
    genai.configure(api_key=api_key)
    model = genai.GenerativeModel('gemini-pro')
else:
    # ุงฺฏุฑ ฺฉูุฏ ูุจูุฏุ ุจู ฺฉุงุฑุจุฑ ูพุงู ุจุฏู ู ุจุฑูุงูู ุฑุง ูุชููู ฺฉู
    st.info("ูุทูุงู ุจุฑุง ูุนุงู ุดุฏู ุจุฑูุงููุ ฺฉูุฏ API ุฎูุฏ ุฑุง ุฏุฑ ููุงุฑ ฺฉูุงุฑ ูุงุฑุฏ ฺฉูุฏ.")
    st.stop()

# --- ุจูู ฺฉุฏ ุดูุง ุงุฒ ุงูุฌุง ุดุฑูุน ูโุดูุฏ ---

st.title("๐ฌ ุฏุณุชุงุฑ ูพฺููุด ููุดููุฏ")
topic = st.text_input("ููุถูุน ุชุญูู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:")

if topic:
    # (ุจูู ููุทู ุจุฑูุงูู ุดูุง ฺฉู ุฌุณุชุฌู ุฑุง ุงูุฌุงู ูโุฏูุฏ ู...)
    # ุงู ุจุฎุด ุจุฑุง ููููู ุณุงุฏู ุดุฏู ุงุณุช
    st.write(f"ุฏุฑ ุญุงู ุฌุณุชุฌู ุจุฑุง: {topic}")
    
    try:
        # ุงูุฌุง ุจุงุฏ ฺฉุฏ ุฌุณุชุฌู ูพุงุจโูุฏ ุดูุง ุจุงุฏ
        # ุจุฑุง ุณุงุฏฺฏุ ูุนูุง ฺฉ ูพุงู ููุงุด ูโุฏูู
        st.success("ุฌุณุชุฌู ุจุง ููููุช ุงูุฌุงู ุดุฏ (ุงู ฺฉ ูพุงู ุชุณุช ุงุณุช).")

        # ุงูุฌุง ูโุชูุงูุฏ ุฏฺฉููโูุง ุชุญูู ุฑุง ุงุถุงูู ฺฉูุฏ
        if st.button("ุงูุชู ฺฏูพโูุง ุชุญููุงุช"):
            with st.spinner("ุฏุฑ ุญุงู ุชุญูู..."):
                prompt = f"Find research gaps for the topic: {topic}"
                response = model.generate_content(prompt)
                st.markdown(response.text)

    except Exception as e:
        st.error(f"ุฎุทุง ุฑุฎ ุฏุงุฏ: {e}")